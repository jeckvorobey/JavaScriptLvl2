class Cart{constructor(t,e="#cart"){this.source=t,this.container=e,this.countGoods=0,this.amount=0,this.cartItems=[],this._init()}_render(){let t=$("<div/>",{class:"cart-items-wrap"}),e=$("<div/>",{class:"cart-summary sum-count"}),a=$("<div/>",{class:"cart-summary sum-price"});$(this.container).text("Корзина"),t.appendTo($(this.container)),e.appendTo($(this.container)),a.appendTo($(this.container))}_init(){this._render(),fetch(this.source).then(t=>t.json()).then(t=>{for(let e of t.contents)this.cartItems.push(e),this._renderProduct(e);this.amount=t.amount,this.countGoods=t.countGoods,this._renderSum()})}_renderProduct(t){let e=$("<div/>",{class:"cart-item","data-product":t.id_product}),a=$("<img/>",{class:"removeIcon",alt:"del",src:"./images/icon/garbage.svg",title:"Удалить","data-id":t.id_product});e.append($(`<p class="product-name">${t.product_name}</p>`)),e.append($(`<p class="product-quantity">${t.quantity}</p>`)),e.append($(`<p class="product-price">${t.price} руб.</p>`)),e.append($(`<input type="text" class="countRemove" data-id="${t.id_product}" value="1">`)),e.append(a),a.click(t=>{this.removeProduct(t.target)}),e.appendTo($(".cart-items-wrap"))}_renderSum(){$(".sum-count").text(`Всего товаров в корзине: ${this.countGoods}`),$(".sum-price").text(`Сумма товаров в корзине: ${this.amount}`)}_updateCart(t){let e=$(`div[data-product="${t.id_product}"]`);e.find(".product-quantity").text(t.quantity),e.find(".product-price").text(`${t.quantity*t.price} руб.`)}addProduct(t){let e=+$(t).data("id"),a=this.cartItems.find(t=>t.id_product===e);if(a)a.quantity++,this.countGoods++,this.amount+=a.price,this._updateCart(a);else{let a={id_product:e,price:+$(t).data("price"),product_name:$(t).data("title"),quantity:1};this.cartItems.push(a),this.amount+=a.price,this.countGoods+=a.quantity,this._renderProduct(a)}this._renderSum()}removeProduct(t){let e=+$(t).data("id"),a=+$(`.countRemove[data-id="${e}"]`).val(),i=this.cartItems.find(t=>t.id_product===e);0===a||a>i.quantity?$(`.countRemove[data-id="${e}"]`).addClass("removeError"):a<i.quantity?($(`.countRemove[data-id="${e}"]`).removeClass("removeError"),i.quantity-=a,this.countGoods-=a,this.amount-=i.price*a,this._updateCart(i)):($(`.countRemove[data-id="${e}"]`).removeClass("removeError"),$(`div[data-product="${e}"]`).remove(),this.countGoods-=a,this.amount-=i.price*a,this.cartItems.splice(this.cartItems.indexOf(i),1)),this._updateCart(i),this._renderSum()}}